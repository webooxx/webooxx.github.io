---
layout: post
title: 16格抽奖程序
tags:
  - js特效
  - 单页应用
originContent: "有时候需要个抽奖的界面，现在抽出来单独做个应用，年会上抽奖可以用。\n\n## 运行界面：\n\n[预览\b地址](/ddemo/reward-maching.html)\n\n![效果预览](/images/2016-10-30 10.18.29.png)\n\n\n## 关键代码\n\n\n#### 盒子设定\n\n```` javascript\nvar size = 5;\n\n\nvar items = [];\nvar items_top = [];\nvar items_bottom=[]\nvar items_right = [];\nvar items_left = [];\n\nvar box = $('.box');  // 容器\n\nbox.css('width',size*100+'px'); // 默认100*100 是每个\b\b\b\b\e格子\b的大小\nbox.css('height',size*100+'px')\n\n\n````\n\n\n#### 插入中奖方块\n\n```` javascript\n$.each(Array(size),function (x) {\n  $.each(Array(size),function (y) {\n      var idx = x*size + y;\n      var id = 'i_'+idx;\n      box.append('<div class=\"box__item\" data-idx=\"'+idx+'\" id=\"'+id+'\">');\n\n      // 把id分成四个部分\n      if( idx > size  && idx%size == size-1 && idx < size*size-size){\n        items_right.push(id);\n      }\n      if( idx > size-1  && idx%size == 0 && idx < size*size-size){\n        items_left.push(id);\n      }\n      if( idx< size){\n        items_top.push(id);\n      }\n      if(idx > size*size-size-1  ){\n          items_bottom.push(id);\n      }\n\n  });        \n});\n````\n\n#### 调整id顺序为逆时针\n\n```` javascript\nitems = items_top.join(',')+','+items_right.join(',')+','+items_bottom.reverse().join(',')+','+items_left.reverse().join(',');\nitems = items.split(',');\n\n$.each(items,function  (i,id) {\n  $('#'+id).text(i+1)\n})\n\n````\n\n#### 抽奖开始\n\n```` javascript\n\nvar last = '';  // 重新开始会从上一个结束的地方开始\nvar go = function (num) {\n\n    var end = items.slice(0,num+1).join(',');\n\n    var all = items.join(',');\n    var arr = (last+all+','+all+','+all+','+end).split(',');\n    var len = arr.length -1;\n\n     last = items.slice(num+1).join(',')+',';\n\n    $.each(arr,function  (i,item) {\n      setTimeout(function  () {\n        $('.box__item').removeClass('highlight');\n        $('#'+item).addClass('highlight');\n      },100*i); // 这个动画效果 ~_~!!!\n\n    })\n}\n\ngo( ~~ (Math.random()*items.length )  )\n````"
categories:
  - 游戏
toc: true
date: 2016-10-30 09:51:21
---

有时候需要个抽奖的界面，现在抽出来单独做个应用，年会上抽奖可以用。

## 运行界面：

[预览地址](/ddemo/reward-maching.html)

![效果预览](/images/2016-10-30 10.18.29.png)


## 关键代码


#### 盒子设定

```` javascript
var size = 5;


var items = [];
var items_top = [];
var items_bottom=[]
var items_right = [];
var items_left = [];

var box = $('.box');  // 容器

box.css('width',size*100+'px'); // 默认100*100 是每个格子的大小
box.css('height',size*100+'px')


````


#### 插入中奖方块

```` javascript
$.each(Array(size),function (x) {
  $.each(Array(size),function (y) {
      var idx = x*size + y;
      var id = 'i_'+idx;
      box.append('<div class="box__item" data-idx="'+idx+'" id="'+id+'">');

      // 把id分成四个部分
      if( idx > size  && idx%size == size-1 && idx < size*size-size){
        items_right.push(id);
      }
      if( idx > size-1  && idx%size == 0 && idx < size*size-size){
        items_left.push(id);
      }
      if( idx< size){
        items_top.push(id);
      }
      if(idx > size*size-size-1  ){
          items_bottom.push(id);
      }

  });        
});
````

#### 调整id顺序为逆时针

```` javascript
items = items_top.join(',')+','+items_right.join(',')+','+items_bottom.reverse().join(',')+','+items_left.reverse().join(',');
items = items.split(',');

$.each(items,function  (i,id) {
  $('#'+id).text(i+1)
})

````

#### 抽奖开始

```` javascript

var last = '';  // 重新开始会从上一个结束的地方开始
var go = function (num) {

    var end = items.slice(0,num+1).join(',');

    var all = items.join(',');
    var arr = (last+all+','+all+','+all+','+end).split(',');
    var len = arr.length -1;

     last = items.slice(num+1).join(',')+',';

    $.each(arr,function  (i,item) {
      setTimeout(function  () {
        $('.box__item').removeClass('highlight');
        $('#'+item).addClass('highlight');
      },100*i); // 这个动画效果 ~_~!!!

    })
}

go( ~~ (Math.random()*items.length )  )
````