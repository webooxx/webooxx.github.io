---
title: 使用indexOf成双成对的匹配标签
date: 2017-08-15 17:54:45
tags: js,算法
---

成双成对的匹配HTML标签，主要是 indexOf，没有若使用复杂的正则

````js
/**
 * 成双成对的匹配标签outerHTML
 * @param html                HTML字符串内容
 * @param tagName             标签名称
 * @param initStartPosition   起始位置
 */

function getPairwiseTagPosition( html , tagName , initStartPosition){

    var tagStartPositionStack = [initStartPosition];

    //  获取下一个开始或者结束标签的位置
    var nextTagStartOrClose = function ( position , content ){
        var startPosition = content.indexOf('<'+tagName,position+1);
        var closePosition  = content.indexOf('</'+tagName+'>',position+1);
        console.log(startPosition,closePosition,startPosition > position)
        if (startPosition <  closePosition && startPosition > position){ //  谁小谁在前,如果只有一个标签，如body，直接略过
            return ['START',startPosition]
        }else{
            return ['CLOSE',closePosition]
        }
    }
    //  开始计算
    var calc = function( startPosition ){

        //  异常处理
        if( startPosition < 0 || startPosition > html.length){
            return [0,0];
        }

        //  主要逻辑
        var next = nextTagStartOrClose( startPosition , html );

        console.log('NEXT',next)

        if( next[0] === 'CLOSE' ){  //  结束标签，需要推出一个开始标签位置
            var startPosition = tagStartPositionStack.pop();
            var closePosition = next[1];

            if( tagStartPositionStack.length <= 0 ){
                return [startPosition,closePosition -0 + tagName.length + 3] // 修正结束位置，包含结束标签
            }else{
                return calc( next[1] );
            }
        }

        if(next[0] === 'START'){    // 开始标签标记，需要压入一个开始标签位置
            tagStartPositionStack.push(  next[1] );
            return calc( next[1] );
        }
    }

    return calc(initStartPosition);

}

//getPairwiseTagPosition( document.body.innerHTML , 'div' , document.body.innerHTML.indexOf('<div id="main"') )

getPairwiseTagPosition( document.body.outerHTML , 'body' , document.body.outerHTML.indexOf('<body') )

````
